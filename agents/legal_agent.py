"""
æ³•å¾‹å’¨è¯¢Agent

æä¾›æ³•å¾‹çŸ¥è¯†ç§‘æ™®ã€å¸¸è§æ³•å¾‹é—®é¢˜è§£ç­”ç­‰æœåŠ¡ã€‚
è¿™æ˜¯ä¸€ä¸ªå…·æœ‰é«˜å•†ä¸šä»·å€¼çš„Agentï¼Œé€‚ç”¨äºŽæ³•å¾‹å’¨è¯¢é¢†åŸŸã€‚
"""
from typing import Dict, Any, Optional
from src.agents import BaseAgent, Message, ChatContext, AgentResponse, SQLiteMemoryStore


class LegalAgent(BaseAgent):
    """
    æ³•å¾‹å’¨è¯¢Agent - æä¾›æ³•å¾‹çŸ¥è¯†å’¨è¯¢
    
    ä¸“é•¿é¢†åŸŸ:
    - åŠ³åŠ¨æ³•ï¼šåŠ³åŠ¨åˆåŒã€å·¥èµ„çº çº·ã€åŠ ç­ç­‰
    - æ¶ˆè´¹è€…æƒç›Šï¼šé€€æ¢è´§ã€ç»´æƒç­‰
    - æˆ¿äº§æ³•å¾‹ï¼šç§Ÿæˆ¿ã€ä¹°æˆ¿ç›¸å…³é—®é¢˜
    - åˆåŒæ³•ï¼šåˆåŒçº çº·ã€è¿çº¦ç­‰
    - å©šå§»å®¶åº­ï¼šç¦»å©šã€è´¢äº§åˆ†å‰²ç­‰
    
    é€‚ç”¨åœºæ™¯:
    - "å…¬å¸ä¸ç»™åŠ ç­è´¹æ€Žä¹ˆåŠžï¼Ÿ"
    - "ä¹°åˆ°å‡è´§å¦‚ä½•ç»´æƒï¼Ÿ"
    - "ç¦»å©šè´¢äº§å¦‚ä½•åˆ†å‰²ï¼Ÿ"
    """
    
    def __init__(self, memory_store=None, llm_provider=None):
        """
        åˆå§‹åŒ–æ³•å¾‹å’¨è¯¢Agent
        """
        self._name = "LegalAgent"
        self._description = (
            "æä¾›æ³•å¾‹çŸ¥è¯†å’¨è¯¢å’ŒæŒ‡å¯¼ã€‚"
            "æ¶µç›–åŠ³åŠ¨æ³•ã€æ¶ˆè´¹è€…æƒç›Šã€åˆåŒæ³•ç­‰é¢†åŸŸï¼Œ"
            "å¸®åŠ©ç”¨æˆ·äº†è§£æ³•å¾‹æƒç›Šå’Œç»´æƒé€”å¾„ã€‚"
        )
        self._memory = memory_store or SQLiteMemoryStore()
        self._llm_provider = llm_provider
        
        # æ³•å¾‹ç›¸å…³å…³é”®è¯
        self._legal_keywords = [
            # é€šç”¨æ³•å¾‹
            "æ³•å¾‹", "æ³•è§„", "åˆæ³•", "è¿æ³•", "æƒç›Š", "ç»´æƒ",
            "law", "legal", "rights", "illegal",
            "è¯‰è®¼", "èµ·è¯‰", "å¾‹å¸ˆ", "æ³•é™¢", "åˆ¤å†³",
            
            # åŠ³åŠ¨æ³•
            "åŠ³åŠ¨", "å·¥èµ„", "åŠ ç­", "è¾žé€€", "è§£é›‡", "ç¤¾ä¿",
            "åŠ³åŠ¨åˆåŒ", "è¯•ç”¨æœŸ", "ç¦»èŒ", "è¡¥å¿é‡‘",
            "employment", "salary", "overtime", "fired",
            
            # æ¶ˆè´¹è€…æƒç›Š
            "æ¶ˆè´¹è€…", "é€€è´§", "é€€æ¬¾", "å‡è´§", "æŠ•è¯‰",
            "consumer", "refund", "fake", "complaint",
            "315", "å·¥å•†", "è´¨é‡é—®é¢˜",
            
            # æˆ¿äº§
            "æˆ¿äº§", "ç§Ÿæˆ¿", "ä¹°æˆ¿", "æˆ¿ä¸œ", "ç§Ÿå®¢", "æŠ¼é‡‘",
            "ç§Ÿèµ", "åˆåŒ", "ä¸­ä»‹",
            "property", "rent", "landlord", "tenant",
            
            # å©šå§»å®¶åº­
            "å©šå§»", "ç¦»å©š", "è´¢äº§åˆ†å‰²", "æŠšå…»æƒ", "å½©ç¤¼",
            "marriage", "divorce", "custody",
            
            # åˆåŒ
            "åˆåŒ", "åè®®", "è¿çº¦", "èµ”å¿", "å®šé‡‘",
            "contract", "agreement", "breach",
        ]
        
        # ç³»ç»Ÿæç¤ºè¯
        self._system_prompt = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ³•å¾‹å’¨è¯¢é¡¾é—®ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„æ³•å¾‹çŸ¥è¯†ã€‚

ä½ çš„èŒè´£ï¼š
1. æä¾›æ³•å¾‹çŸ¥è¯†ç§‘æ™®å’Œè§£ç­”
2. å¸®åŠ©ç”¨æˆ·äº†è§£è‡ªå·±çš„åˆæ³•æƒç›Š
3. æŒ‡å¯¼ç”¨æˆ·å¦‚ä½•ç»´æŠ¤è‡ªèº«æƒç›Š
4. è§£é‡Šç›¸å…³æ³•å¾‹æ³•è§„

é‡è¦åŽŸåˆ™ï¼š
- å§‹ç»ˆå£°æ˜Ž"ä»¥ä¸Šä»…ä¾›å‚è€ƒï¼Œå…·ä½“é—®é¢˜è¯·å’¨è¯¢ä¸“ä¸šå¾‹å¸ˆ"
- ä¸æä¾›å…·ä½“çš„æ³•å¾‹å»ºè®®ï¼ŒåªåšçŸ¥è¯†æ™®åŠ
- å»ºè®®ç”¨æˆ·åœ¨å¤æ‚æ¡ˆä»¶ä¸­å¯»æ±‚ä¸“ä¸šæ³•å¾‹å¸®åŠ©
- ä¿æŒå®¢è§‚ä¸­ç«‹ï¼Œä¸åå‘ä»»ä½•ä¸€æ–¹

å›žå¤é£Žæ ¼ï¼š
- ä¸“ä¸šã€ä¸¥è°¨ã€æ˜“æ‡‚
- å¼•ç”¨ç›¸å…³æ³•å¾‹æ³•è§„
- æä¾›å®žç”¨çš„ç»´æƒæ€è·¯"""

    @property
    def name(self) -> str:
        return self._name
    
    @property
    def description(self) -> str:
        return self._description
    
    def can_handle(self, message: Message, context: ChatContext) -> float:
        """åˆ¤æ–­æ˜¯å¦èƒ½å¤„ç†æ­¤æ¶ˆæ¯"""
        if message.has_mention(self.name):
            return 1.0
        
        content = message.content.lower()
        keyword_matches = sum(1 for kw in self._legal_keywords if kw in content)
        
        if keyword_matches >= 3:
            return 0.9
        elif keyword_matches == 2:
            return 0.75
        elif keyword_matches == 1:
            return 0.55
        
        return 0.0
    
    def respond(self, message: Message, context: ChatContext) -> AgentResponse:
        """ç”Ÿæˆæ³•å¾‹å’¨è¯¢å›žå¤"""
        user_memory = self.memory_read(message.user_id)
        interaction_count = user_memory.get("interaction_count", 0)
        
        content = message.get_clean_content().lower()
        
        # è¯†åˆ«ä¸»é¢˜å¹¶ç”Ÿæˆå“åº”
        if any(word in content for word in ["åŠ³åŠ¨", "å·¥èµ„", "åŠ ç­", "è¾žé€€", "ç¤¾ä¿", "ç¦»èŒ"]):
            topic = "labor"
            response = self._respond_labor(message, user_memory)
        elif any(word in content for word in ["æ¶ˆè´¹", "é€€è´§", "é€€æ¬¾", "å‡è´§", "è´¨é‡"]):
            topic = "consumer"
            response = self._respond_consumer(message, user_memory)
        elif any(word in content for word in ["æˆ¿", "ç§Ÿ", "æŠ¼é‡‘", "æˆ¿ä¸œ", "ä¸­ä»‹"]):
            topic = "property"
            response = self._respond_property(message, user_memory)
        elif any(word in content for word in ["å©š", "ç¦»å©š", "è´¢äº§åˆ†å‰²", "æŠšå…»"]):
            topic = "marriage"
            response = self._respond_marriage(message, user_memory)
        elif any(word in content for word in ["åˆåŒ", "åè®®", "è¿çº¦", "å®šé‡‘"]):
            topic = "contract"
            response = self._respond_contract(message, user_memory)
        else:
            topic = "general"
            response = self._respond_general(message, interaction_count)
        
        # æ›´æ–°ç”¨æˆ·è®°å¿†
        user_memory["interaction_count"] = interaction_count + 1
        user_memory["last_topic"] = topic
        self.memory_write(message.user_id, user_memory)
        
        return AgentResponse(
            content=response,
            agent_name=self.name,
            confidence=0.85,
            metadata={"topic": topic},
            should_continue=False
        )
    
    def _respond_labor(self, message: Message, user_memory: Dict) -> str:
        """åŠ³åŠ¨æ³•ç›¸å…³å“åº”"""
        return (
            "âš–ï¸ **åŠ³åŠ¨æ³•å¾‹å’¨è¯¢**\n\n"
            "å…³äºŽæ‚¨çš„åŠ³åŠ¨æƒç›Šé—®é¢˜ï¼Œæˆ‘æ¥è§£ç­”ï¼š\n\n"
            "**å¸¸è§åŠ³åŠ¨æƒç›Šä¿æŠ¤ï¼š**\n\n"
            "ðŸ“‹ **åŠ³åŠ¨åˆåŒ**\n"
            "â€¢ ç”¨äººå•ä½å¿…é¡»åœ¨å…¥èŒ1ä¸ªæœˆå†…ç­¾è®¢ä¹¦é¢åˆåŒ\n"
            "â€¢ æœªç­¾åˆåŒå¯ä¸»å¼ åŒå€å·¥èµ„ï¼ˆæœ€å¤š11ä¸ªæœˆï¼‰\n\n"
            "ðŸ’° **åŠ ç­å·¥èµ„**\n"
            "â€¢ å·¥ä½œæ—¥åŠ ç­ï¼š1.5å€\n"
            "â€¢ ä¼‘æ¯æ—¥åŠ ç­ï¼š2å€\n"
            "â€¢ æ³•å®šèŠ‚å‡æ—¥ï¼š3å€\n\n"
            "ðŸšª **ç¦»èŒä¸Žè¡¥å¿**\n"
            "â€¢ è¢«è¿æ³•è¾žé€€å¯ä¸»å¼ 2Nç»æµŽèµ”å¿é‡‘\n"
            "â€¢ æ­£å¸¸è§£é™¤åˆåŒå¯èŽ·Næˆ–N+1è¡¥å¿\n"
            "â€¢ N = å·¥ä½œå¹´é™ Ã— æœˆå¹³å‡å·¥èµ„\n\n"
            "ðŸ“± **ç»´æƒé€”å¾„ï¼š**\n"
            "1. ä¸Žå…¬å¸HRåå•†\n"
            "2. å‘åŠ³åŠ¨ç›‘å¯Ÿå¤§é˜ŸæŠ•è¯‰\n"
            "3. ç”³è¯·åŠ³åŠ¨ä»²è£\n"
            "4. ä¸æœä»²è£å¯å‘æ³•é™¢èµ·è¯‰\n\n"
            "âš ï¸ **é‡è¦æé†’**ï¼šåŠ³åŠ¨ä»²è£æ—¶æ•ˆä¸º1å¹´ï¼Œ"
            "è¯·åŠæ—¶ä¿ç•™è¯æ®ï¼ˆå·¥èµ„æ¡ã€è€ƒå‹¤è®°å½•ã€èŠå¤©è®°å½•ç­‰ï¼‰ã€‚\n\n"
            "ðŸ“– ä»¥ä¸Šä»…ä¾›å‚è€ƒï¼Œå…·ä½“é—®é¢˜å»ºè®®å’¨è¯¢ä¸“ä¸šåŠ³åŠ¨æ³•å¾‹å¸ˆã€‚"
        )
    
    def _respond_consumer(self, message: Message, user_memory: Dict) -> str:
        """æ¶ˆè´¹è€…æƒç›Šå“åº”"""
        return (
            "ðŸ›’ **æ¶ˆè´¹è€…æƒç›Šä¿æŠ¤**\n\n"
            "å…³äºŽæ‚¨çš„æ¶ˆè´¹ç»´æƒé—®é¢˜ï¼š\n\n"
            "**æ¶ˆè´¹è€…åŸºæœ¬æƒç›Šï¼š**\n"
            "â€¢ å®‰å…¨æƒ - å•†å“ä¸å¾—å±å®³äººèº«å®‰å…¨\n"
            "â€¢ çŸ¥æƒ…æƒ - äº†è§£å•†å“çœŸå®žä¿¡æ¯\n"
            "â€¢ é€‰æ‹©æƒ - è‡ªä¸»é€‰æ‹©å•†å“å’ŒæœåŠ¡\n"
            "â€¢ å…¬å¹³äº¤æ˜“æƒ - èŽ·å¾—å…¬å¹³äº¤æ˜“æ¡ä»¶\n\n"
            "**ä¸ƒå¤©æ— ç†ç”±é€€è´§ï¼ˆç½‘è´­ï¼‰ï¼š**\n"
            "â€¢ é€‚ç”¨äºŽå¤§éƒ¨åˆ†ç½‘è´­å•†å“\n"
            "â€¢ å•†å“åº”ä¿æŒå®Œå¥½\n"
            "â€¢ å®šåˆ¶ã€é²œæ´»ç­‰ç‰¹æ®Šå•†å“é™¤å¤–\n\n"
            "**å‡è´§ç»´æƒï¼ˆå‡ä¸€èµ”ä¸‰/èµ”åï¼‰ï¼š**\n"
            "â€¢ ç»è¥è€…æ¬ºè¯ˆè¡Œä¸ºï¼šä¸‰å€èµ”å¿\n"
            "â€¢ é£Ÿå“å®‰å…¨é—®é¢˜ï¼šåå€èµ”å¿\n\n"
            "**ç»´æƒæ¸ é“ï¼š**\n"
            "1. ðŸ“ž 12315æ¶ˆè´¹è€…æŠ•è¯‰çƒ­çº¿\n"
            "2. ðŸ›ï¸ å¸‚åœºç›‘ç£ç®¡ç†å±€\n"
            "3. ðŸ’¬ ç”µå•†å¹³å°å®¢æœ\n"
            "4. âš–ï¸ æ¶ˆè´¹è€…åä¼šè°ƒè§£\n"
            "5. ðŸ¢ å‘æ³•é™¢èµ·è¯‰\n\n"
            "ðŸ’¡ **è¯æ®ä¿ç•™**ï¼šè´­ç‰©å‡­è¯ã€èŠå¤©è®°å½•ã€å•†å“ç…§ç‰‡ç­‰ã€‚\n\n"
            "ðŸ“– ä»¥ä¸Šä»…ä¾›å‚è€ƒï¼Œå…·ä½“é—®é¢˜å»ºè®®å’¨è¯¢ä¸“ä¸šå¾‹å¸ˆã€‚"
        )
    
    def _respond_property(self, message: Message, user_memory: Dict) -> str:
        """æˆ¿äº§æ³•å¾‹å“åº”"""
        return (
            "ðŸ  **æˆ¿äº§æ³•å¾‹å’¨è¯¢**\n\n"
            "å…³äºŽæ‚¨çš„æˆ¿äº§é—®é¢˜ï¼š\n\n"
            "**ç§Ÿæˆ¿å¸¸è§é—®é¢˜ï¼š**\n\n"
            "ðŸ“ **æŠ¼é‡‘é—®é¢˜**\n"
            "â€¢ æŠ¼é‡‘ä¸€èˆ¬ä¸º1-3ä¸ªæœˆæˆ¿ç§Ÿ\n"
            "â€¢ åˆåŒåˆ°æœŸæ­£å¸¸é€€ç§Ÿåº”å…¨é¢é€€è¿˜\n"
            "â€¢ æˆ¿ä¸œæ— æƒéšæ„æ‰£æŠ¼æŠ¼é‡‘\n"
            "â€¢ å¯æ‰£é™¤çš„ï¼šæ°´ç”µæ¬ è´¹ã€ç‰©å“æŸåç­‰\n\n"
            "ðŸ”§ **ç»´ä¿®è´£ä»»**\n"
            "â€¢ æˆ¿å±‹è‡ªç„¶æŸè€—ï¼šæˆ¿ä¸œè´Ÿè´£\n"
            "â€¢ ç§Ÿæˆ·äººä¸ºæŸåï¼šç§Ÿæˆ·è´Ÿè´£\n"
            "â€¢ åˆåŒæœ‰çº¦å®šæŒ‰çº¦å®šæ‰§è¡Œ\n\n"
            "ðŸšª **æå‰è§£çº¦**\n"
            "â€¢ çœ‹åˆåŒçº¦å®šçš„è¿çº¦é‡‘æ¡æ¬¾\n"
            "â€¢ ä¸€èˆ¬ä¸º1-2ä¸ªæœˆç§Ÿé‡‘\n"
            "â€¢ åå•†è§£å†³é€šå¸¸æ›´ç»æµŽ\n\n"
            "**ä¹°æˆ¿æ³¨æ„äº‹é¡¹ï¼š**\n"
            "â€¢ æ ¸å®žæˆ¿äº§è¯å’Œäº§æƒäºº\n"
            "â€¢ æŸ¥è¯¢æ˜¯å¦æœ‰æŠµæŠ¼æˆ–æŸ¥å°\n"
            "â€¢ ç¡®è®¤åœŸåœ°ä½¿ç”¨å¹´é™\n"
            "â€¢ èµ„é‡‘èµ°ä¸“ç”¨ç›‘ç®¡è´¦æˆ·\n\n"
            "ðŸ“– ä»¥ä¸Šä»…ä¾›å‚è€ƒï¼Œå…·ä½“é—®é¢˜å»ºè®®å’¨è¯¢ä¸“ä¸šå¾‹å¸ˆã€‚"
        )
    
    def _respond_marriage(self, message: Message, user_memory: Dict) -> str:
        """å©šå§»å®¶åº­å“åº”"""
        return (
            "ðŸ’’ **å©šå§»å®¶åº­æ³•å¾‹å’¨è¯¢**\n\n"
            "å…³äºŽæ‚¨çš„å©šå§»é—®é¢˜ï¼š\n\n"
            "**ç¦»å©šæ–¹å¼ï¼š**\n"
            "ðŸ“‹ åè®®ç¦»å©š\n"
            "â€¢ åŒæ–¹è¾¾æˆä¸€è‡´\n"
            "â€¢ åˆ°æ°‘æ”¿å±€åŠžç†\n"
            "â€¢ æœ‰30å¤©å†·é™æœŸ\n\n"
            "âš–ï¸ è¯‰è®¼ç¦»å©š\n"
            "â€¢ ä¸€æ–¹ä¸åŒæ„æˆ–æœ‰äº‰è®®\n"
            "â€¢ å‘æ³•é™¢èµ·è¯‰\n"
            "â€¢ è°ƒè§£ä¸æˆåˆ¤å†³ç¦»å©š\n\n"
            "**è´¢äº§åˆ†å‰²åŽŸåˆ™ï¼š**\n"
            "â€¢ å©šå‰è´¢äº§å½’ä¸ªäººæ‰€æœ‰\n"
            "â€¢ å©šåŽå…±åŒè´¢äº§åŽŸåˆ™ä¸Šå¹³åˆ†\n"
            "â€¢ ç…§é¡¾å¥³æ–¹å’Œå­å¥³åŽŸåˆ™\n"
            "â€¢ è¿‡é”™æ–¹å¯å°‘åˆ†æˆ–ä¸åˆ†\n\n"
            "**å­å¥³æŠšå…»æƒï¼š**\n"
            "â€¢ 2å²ä»¥ä¸‹ä¸€èˆ¬å½’æ¯æ–¹\n"
            "â€¢ 2-8å²ç»¼åˆè€ƒè™‘åŒæ–¹æ¡ä»¶\n"
            "â€¢ 8å²ä»¥ä¸Šå°Šé‡å­å¥³æ„æ„¿\n"
            "â€¢ æŠšå…»è´¹ä¸€èˆ¬ä¸ºæ”¶å…¥çš„20-30%\n\n"
            "âš ï¸ å©šå§»å®¶åº­é—®é¢˜æ¶‰åŠå¤æ‚çš„æ³•å¾‹å’Œæƒ…æ„Ÿå› ç´ ï¼Œ"
            "å»ºè®®å’¨è¯¢ä¸“ä¸šå©šå§»å®¶äº‹å¾‹å¸ˆã€‚\n\n"
            "ðŸ“– ä»¥ä¸Šä»…ä¾›å‚è€ƒï¼Œå…·ä½“é—®é¢˜è¯·å¯»æ±‚ä¸“ä¸šæ³•å¾‹å¸®åŠ©ã€‚"
        )
    
    def _respond_contract(self, message: Message, user_memory: Dict) -> str:
        """åˆåŒæ³•å“åº”"""
        return (
            "ðŸ“„ **åˆåŒæ³•å¾‹å’¨è¯¢**\n\n"
            "å…³äºŽæ‚¨çš„åˆåŒé—®é¢˜ï¼š\n\n"
            "**åˆåŒæœ‰æ•ˆè¦ä»¶ï¼š**\n"
            "â€¢ åŒæ–¹å…·æœ‰æ°‘äº‹è¡Œä¸ºèƒ½åŠ›\n"
            "â€¢ æ„æ€è¡¨ç¤ºçœŸå®ž\n"
            "â€¢ ä¸è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®š\n"
            "â€¢ ä¸è¿èƒŒå…¬åºè‰¯ä¿—\n\n"
            "**å®šé‡‘ä¸Žè®¢é‡‘åŒºåˆ«ï¼š**\n"
            "ðŸ’° **å®šé‡‘**\n"
            "â€¢ å…·æœ‰æ‹…ä¿æ€§è´¨\n"
            "â€¢ ä¹°æ–¹è¿çº¦ï¼šå®šé‡‘ä¸é€€\n"
            "â€¢ å–æ–¹è¿çº¦ï¼šåŒå€è¿”è¿˜\n"
            "â€¢ ä¸è¶…è¿‡åˆåŒé‡‘é¢çš„20%\n\n"
            "ðŸ’µ **è®¢é‡‘**\n"
            "â€¢ åªæ˜¯é¢„ä»˜æ¬¾æ€§è´¨\n"
            "â€¢ ä»»ä½•ä¸€æ–¹è¿çº¦éƒ½å¯é€€è¿˜\n\n"
            "**è¿çº¦è´£ä»»ï¼š**\n"
            "â€¢ ç»§ç»­å±¥è¡Œ\n"
            "â€¢ é‡‡å–è¡¥æ•‘æŽªæ–½\n"
            "â€¢ èµ”å¿æŸå¤±\n"
            "â€¢ æ”¯ä»˜è¿çº¦é‡‘\n\n"
            "âš ï¸ **ç­¾åˆåŒæ³¨æ„ï¼š**\n"
            "â€¢ ä»”ç»†é˜…è¯»æ‰€æœ‰æ¡æ¬¾\n"
            "â€¢ ç‰¹åˆ«æ³¨æ„è¿çº¦è´£ä»»æ¡æ¬¾\n"
            "â€¢ å¯¹æ–¹çš„éœ¸çŽ‹æ¡æ¬¾å¯ä¸»å¼ æ— æ•ˆ\n"
            "â€¢ é‡è¦åˆåŒå»ºè®®å¾‹å¸ˆå®¡æ ¸\n\n"
            "ðŸ“– ä»¥ä¸Šä»…ä¾›å‚è€ƒï¼Œå…·ä½“é—®é¢˜å»ºè®®å’¨è¯¢ä¸“ä¸šå¾‹å¸ˆã€‚"
        )
    
    def _respond_general(self, message: Message, interaction_count: int) -> str:
        """é€šç”¨æ³•å¾‹å“åº”"""
        if interaction_count == 0:
            return (
                "âš–ï¸ **æ¬¢è¿Žå’¨è¯¢æ³•å¾‹æœåŠ¡**\n\n"
                "æˆ‘æ˜¯æ‚¨çš„æ³•å¾‹çŸ¥è¯†é¡¾é—®ï¼Œå¯ä»¥å¸®åŠ©æ‚¨äº†è§£ï¼š\n\n"
                "ðŸ‘” åŠ³åŠ¨æ³•å¾‹\n"
                "â€¢ åŠ³åŠ¨åˆåŒã€å·¥èµ„çº çº·\n"
                "â€¢ åŠ ç­è´¹ã€è§£é›‡èµ”å¿\n\n"
                "ðŸ›’ æ¶ˆè´¹è€…æƒç›Š\n"
                "â€¢ é€€æ¢è´§æ”¿ç­–\n"
                "â€¢ å‡è´§ç»´æƒ\n\n"
                "ðŸ  æˆ¿äº§æ³•å¾‹\n"
                "â€¢ ç§Ÿæˆ¿çº çº·\n"
                "â€¢ ä¹°æˆ¿æ³¨æ„äº‹é¡¹\n\n"
                "ðŸ’’ å©šå§»å®¶åº­\n"
                "â€¢ ç¦»å©šç¨‹åº\n"
                "â€¢ è´¢äº§åˆ†å‰²\n\n"
                "ðŸ“„ åˆåŒé—®é¢˜\n"
                "â€¢ è¿çº¦è´£ä»»\n"
                "â€¢ å®šé‡‘è®¢é‡‘åŒºåˆ«\n\n"
                "è¯·å‘Šè¯‰æˆ‘æ‚¨æƒ³äº†è§£ä»€ä¹ˆæ³•å¾‹é—®é¢˜ï¼Ÿ"
            )
        else:
            return (
                "âš–ï¸ æˆ‘éšæ—¶å‡†å¤‡ä¸ºæ‚¨è§£ç­”æ³•å¾‹é—®é¢˜ã€‚\n\n"
                "æ— è®ºæ˜¯åŠ³åŠ¨æƒç›Šã€æ¶ˆè´¹ç»´æƒï¼Œè¿˜æ˜¯æˆ¿äº§åˆåŒé—®é¢˜ï¼Œ"
                "éƒ½å¯ä»¥è·Ÿæˆ‘äº¤æµã€‚\n\n"
                "âš ï¸ æ¸©é¦¨æé†’ï¼šå¤æ‚æ¡ˆä»¶å»ºè®®å’¨è¯¢ä¸“ä¸šå¾‹å¸ˆã€‚\n\n"
                "è¯·é—®æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ"
            )
    
    def memory_read(self, user_id: str) -> Dict[str, Any]:
        return self._memory.read(self.name, user_id)
    
    def memory_write(self, user_id: str, data: Dict[str, Any]) -> None:
        self._memory.write(self.name, user_id, data)
