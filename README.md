# SoulmateBot - æ™ºèƒ½æƒ…æ„Ÿé™ªä¼´æœºå™¨äºº

<div align="center">

åŸºäº Telegram çš„ä¸“ä¸šæ™ºèƒ½æƒ…æ„Ÿé™ªä¼´æœºå™¨äººç³»ç»Ÿï¼Œæ”¯æŒ**å¤šAgentæ¶æ„**ï¼Œæä¾›æƒ…æ„Ÿä»·å€¼å’Œå·¥å…·è°ƒç”¨èƒ½åŠ›ã€‚

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://www.python.org/)
[![Telegram](https://img.shields.io/badge/Telegram-Bot-blue.svg)](https://telegram.org/)

**å•†ä¸šè½¯ä»¶ - ç‰ˆæƒæ‰€æœ‰ Â© 2026**

</div>

---

## ğŸ“– ç›®å½•

- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [Agentç³»ç»Ÿæ¶æ„](#agentç³»ç»Ÿæ¶æ„)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [äºŒæ¬¡å¼€å‘æŒ‡å—](#äºŒæ¬¡å¼€å‘æŒ‡å—)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### åŒæ ¸å¿ƒèƒ½åŠ›

**1. æƒ…æ„Ÿä»·å€¼æä¾›**
- ğŸ’¬ **æ™ºèƒ½æƒ…æ„Ÿå¯¹è¯** - åŸºäºå…ˆè¿›AIæ¨¡å‹çš„æƒ…æ„Ÿé™ªä¼´
- ğŸ­ **æƒ…æ„Ÿè¯†åˆ«ä¸å“åº”** - è¯†åˆ«ç”¨æˆ·æƒ…ç»ªå¹¶æä¾›é’ˆå¯¹æ€§æ”¯æŒ
- ğŸ’­ **è®°å¿†ç³»ç»Ÿ** - è®°ä½ç”¨æˆ·åå¥½å’Œå†å²å¯¹è¯
- ğŸ¤— **å…±æƒ…èƒ½åŠ›** - æä¾›æ¸©æš–ã€ç†è§£å’Œæ”¯æŒ

**2. å·¥å…·è°ƒç”¨èƒ½åŠ›**
- ğŸ”§ **æŠ€æœ¯æ”¯æŒ** - ç¼–ç¨‹ã€æŠ€æœ¯é—®é¢˜è§£ç­”
- ğŸ› ï¸ **å·¥å…·é›†æˆ** - å¯æ‰©å±•çš„å·¥å…·è°ƒç”¨ç³»ç»Ÿ
- ğŸ“Š **å¤šAgentåä½œ** - ä¸åŒAgentå¤„ç†ä¸åŒç±»å‹ä»»åŠ¡
- ğŸ”€ **æ™ºèƒ½è·¯ç”±** - è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„Agentå“åº”

### ç³»ç»ŸåŠŸèƒ½

- ğŸ¤– **å¤šAgentæ¶æ„** - æƒ…æ„ŸAgentã€æŠ€æœ¯Agentã€å·¥å…·Agentç­‰
- ğŸ“Š **è®¢é˜…ç®¡ç†** - å®Œæ•´çš„è®¢é˜…ç³»ç»Ÿå’Œä½¿ç”¨é™é¢
- ğŸ’³ **æ”¯ä»˜é›†æˆ** - æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼
- ğŸ‘¤ **ç”¨æˆ·ç®¡ç†** - ç”¨æˆ·æ•°æ®å’Œä¼šè¯æŒä¹…åŒ–
- ğŸ“ˆ **ä½¿ç”¨ç»Ÿè®¡** - å®æ—¶è¿½è¸ªå’Œåˆ†æ

### è®¢é˜…è®¡åˆ’

| è®¡åˆ’ | ä»·æ ¼ | æ—¥æ¶ˆæ¯é™é¢ | ç‰¹æ€§ |
|-----|------|----------|------|
| ğŸ†“ å…è´¹ç‰ˆ | Â¥0/æœˆ | 10æ¡ | åŸºç¡€å¯¹è¯ |
| ğŸ’ åŸºç¡€ç‰ˆ | Â¥9.99/æœˆ | 100æ¡ | å›¾ç‰‡åŠŸèƒ½ã€ä¼˜å…ˆå“åº” |
| ğŸ‘‘ é«˜çº§ç‰ˆ | Â¥19.99/æœˆ | 1000æ¡ | æ— é™å›¾ç‰‡ã€ä¸ªæ€§åŒ–ä½“éªŒ |

---

## ğŸ—ï¸ Agentç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

æœ¬ç³»ç»Ÿé‡‡ç”¨**å¤šAgentåä½œ**æ¶æ„ï¼Œæ¯ä¸ªAgentä¸“æ³¨äºç‰¹å®šé¢†åŸŸï¼Œé€šè¿‡æ™ºèƒ½è·¯ç”±ç³»ç»ŸååŒå·¥ä½œï¼š

```
ç”¨æˆ·æ¶ˆæ¯ â†’ è·¯ç”±å™¨ â†’ [æƒ…æ„ŸAgent | æŠ€æœ¯Agent | å·¥å…·Agent] â†’ å“åº”åˆå¹¶ â†’ è¿”å›ç”¨æˆ·
```

### å†…ç½®Agent

#### 1. æƒ…æ„Ÿæ”¯æŒAgent (EmotionalAgent)
**ä¸“é•¿**ï¼šæä¾›æƒ…æ„Ÿä»·å€¼å’Œå¿ƒç†æ”¯æŒ
- è¯†åˆ«æƒ…ç»ªï¼šæ‚²ä¼¤ã€ç„¦è™‘ã€å¿«ä¹ã€æ„¤æ€’ç­‰
- å…±æƒ…å“åº”ï¼šç†è§£å¹¶å›åº”ç”¨æˆ·æ„Ÿå—
- è®°å¿†ç³»ç»Ÿï¼šè®°ä½ç”¨æˆ·çš„æƒ…æ„Ÿå†å²
- æ”¯æŒåœºæ™¯ï¼šæƒ…æ„Ÿå€¾è¯‰ã€å¿ƒç†ç–å¯¼ã€æ—¥å¸¸é™ªä¼´

#### 2. æŠ€æœ¯æ”¯æŒAgent (TechAgent)  
**ä¸“é•¿**ï¼šè§£å†³æŠ€æœ¯é—®é¢˜å’Œæä¾›ç¼–ç¨‹å¸®åŠ©
- ç¼–ç¨‹è¯­è¨€ï¼šPythonã€JavaScriptã€Javaç­‰
- é—®é¢˜ç±»å‹ï¼šè°ƒè¯•ã€ä¼˜åŒ–ã€æ•™ç¨‹ã€è§£é‡Š
- ä»£ç æ”¯æŒï¼šæä¾›ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
- æ”¯æŒåœºæ™¯ï¼šæŠ€æœ¯å’¨è¯¢ã€ä»£ç å®¡æŸ¥ã€å­¦ä¹ æŒ‡å¯¼

#### 3. å·¥å…·è°ƒç”¨Agent (ToolAgent) ğŸ†•
**ä¸“é•¿**ï¼šè°ƒç”¨å¤–éƒ¨å·¥å…·å®Œæˆå®é™…ä»»åŠ¡
- ä¿¡æ¯æŸ¥è¯¢ï¼šå¤©æ°”ã€æ–°é—»ã€æœç´¢ç­‰
- ä»»åŠ¡æ‰§è¡Œï¼šæé†’ã€è®¡ç®—ã€è½¬æ¢ç­‰
- APIé›†æˆï¼šç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨
- æ”¯æŒåœºæ™¯ï¼šå®ç”¨å·¥å…·ã€ç”Ÿäº§åŠ›æå‡

### Agentè·¯ç”±æœºåˆ¶

```python
# æ™ºèƒ½é€‰æ‹©æœ€åˆé€‚çš„Agent
1. è§£æ@æåŠ â†’ ç›´æ¥è°ƒç”¨æŒ‡å®šAgent
2. å…³é”®è¯åŒ¹é… â†’ è®¡ç®—æ¯ä¸ªAgentçš„ç½®ä¿¡åº¦
3. ä¸Šä¸‹æ–‡åˆ†æ â†’ è€ƒè™‘å†å²å¯¹è¯å†…å®¹
4. ç½®ä¿¡åº¦æ’åº â†’ é€‰æ‹©æœ€åˆé€‚çš„Agent(s)
5. å¹¶è¡Œæ‰§è¡Œ â†’ å¯é…ç½®å¤šAgentåŒæ—¶å“åº”
```

### æ‰©å±•æ€§è®¾è®¡

ç³»ç»Ÿæ”¯æŒè½»æ¾æ·»åŠ æ–°çš„Agentï¼š

```python
from src.agents import BaseAgent

class CustomAgent(BaseAgent):
    def can_handle(self, message, context) -> float:
        # è¿”å›0.0-1.0çš„ç½®ä¿¡åº¦åˆ†æ•°
        pass
    
    def respond(self, message, context) -> AgentResponse:
        # ç”Ÿæˆå“åº”
        pass
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Python 3.11+
- **Bot æ¡†æ¶**: python-telegram-bot 20.7
- **AI é›†æˆ**: OpenAI GPT-4 / Anthropic Claude / vLLM
- **æ”¯ä»˜é›†æˆ**: å¾®ä¿¡æ”¯ä»˜ / Stripe
- **æ•°æ®åº“**: PostgreSQL + SQLAlchemy ORM
- **ç¼“å­˜**: Redis
- **ä»»åŠ¡é˜Ÿåˆ—**: Celery (å¯é€‰)
- **å®¹å™¨åŒ–**: Docker + Docker Compose

### ç³»ç»Ÿæ¶æ„ï¼ˆå¤šæœºå™¨äººç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Telegram   â”‚
â”‚   Users     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Telegram Bot API           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SoulmateBot Core (Multi-Bot)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Handlers Layer                          â”‚   â”‚
â”‚  â”‚  - Commands                              â”‚   â”‚
â”‚  â”‚  - Bot Management (NEW)                  â”‚   â”‚
â”‚  â”‚  - Message Router (NEW)                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Services Layer                          â”‚   â”‚
â”‚  â”‚  - Bot Manager (NEW)                     â”‚   â”‚
â”‚  â”‚  - Channel Manager (NEW)                 â”‚   â”‚
â”‚  â”‚  - Message Router (NEW)                  â”‚   â”‚
â”‚  â”‚  - AI Conversation                       â”‚   â”‚
â”‚  â”‚  - Image Service                         â”‚   â”‚
â”‚  â”‚  - Subscription Service                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Database Layer                          â”‚   â”‚
â”‚  â”‚  - Bot Configuration (NEW)               â”‚   â”‚
â”‚  â”‚  - Channel Management (NEW)              â”‚   â”‚
â”‚  â”‚  - Bot-Channel Mapping (NEW)             â”‚   â”‚
â”‚  â”‚  - User Management                       â”‚   â”‚
â”‚  â”‚  - Conversation History                  â”‚   â”‚
â”‚  â”‚  - Usage Tracking                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚           â”‚
       â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQL â”‚  â”‚  Redis  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Multiple AI Providers  â”‚
â”‚  - OpenAI GPT-4         â”‚
â”‚  - Anthropic Claude     â”‚
â”‚  - vLLM (Self-hosted)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.11 æˆ–æ›´é«˜ç‰ˆæœ¬
- PostgreSQL 15+ (å¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨ SQLite)
- Telegram Bot Token
- OpenAI/Anthropic API Key

### æœ¬åœ°å¼€å‘

1. **å…‹éš†ä»“åº“**ï¼ˆéœ€è¦æˆæƒï¼‰

2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows
```

3. **å®‰è£…ä¾èµ–**

```bash
pip install -r requirements.txt
```

4. **é…ç½®ç¯å¢ƒå˜é‡**

```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥é…ç½®ä¿¡æ¯
```

5. **åˆå§‹åŒ–æ•°æ®åº“**

```bash
python -c "from src.database import init_db; init_db()"
```

6. **è¿è¡Œæœºå™¨äºº**

```bash
python main.py
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ä»¥ä¸‹å˜é‡ï¼š

#### Telegram é…ç½®

```env
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_WEBHOOK_URL=https://your-domain.com/webhook  # å¯é€‰
```

#### AI æä¾›å•†é…ç½®

```env
# OpenAI
OPENAI_API_KEY=your_openai_api_key
OPENAI_MODEL=gpt-4

# æˆ–ä½¿ç”¨ Anthropic Claude
ANTHROPIC_API_KEY=your_anthropic_api_key
ANTHROPIC_MODEL=claude-3-sonnet-20240229

# æˆ–ä½¿ç”¨ vLLM (è‡ªæ‰˜ç®¡ LLM æ¨ç†æœåŠ¡å™¨)
VLLM_API_URL=http://localhost:8000
VLLM_API_TOKEN=your_vllm_api_token
VLLM_MODEL=your_model_name
```

#### æ•°æ®åº“é…ç½®

```env
# PostgreSQL (ç”Ÿäº§ç¯å¢ƒæ¨è)
DATABASE_URL=postgresql://user:password@localhost:5432/soulmatebot

# æˆ–ä½¿ç”¨ SQLite (å¼€å‘ç¯å¢ƒ)
DATABASE_URL=sqlite:///./soulmatebot.db
```

#### è®¢é˜…é™é¢é…ç½®

```env
FREE_PLAN_DAILY_LIMIT=10
BASIC_PLAN_DAILY_LIMIT=100
PREMIUM_PLAN_DAILY_LIMIT=1000
```

#### æ”¯ä»˜é…ç½®

**å¾®ä¿¡æ”¯ä»˜**

```env
WECHAT_PAY_APP_ID=your_wechat_app_id
WECHAT_PAY_MCH_ID=your_merchant_id
WECHAT_PAY_API_KEY=your_api_key
WECHAT_PAY_API_V3_KEY=your_api_v3_key
WECHAT_PAY_CERT_SERIAL_NO=your_cert_serial_no
WECHAT_PAY_PRIVATE_KEY_PATH=/path/to/apiclient_key.pem
WECHAT_PAY_NOTIFY_URL=https://your-domain.com/wechat/notify
```

**Stripe (å¯é€‰)**

```env
STRIPE_API_KEY=your_stripe_api_key
STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret
```

---

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
SoulmateBot/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ bot/                      # Bot æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ main.py              # Bot ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ handlers/                 # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ commands.py          # å‘½ä»¤å¤„ç†
â”‚   â”‚   â””â”€â”€ messages.py          # æ¶ˆæ¯å¤„ç†
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ database.py          # ORM æ¨¡å‹
â”‚   â”œâ”€â”€ database/                 # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ connection.py
â”‚   â”œâ”€â”€ ai/                       # AI æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ conversation.py      # å¯¹è¯æœåŠ¡
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ image_service.py     # å›¾ç‰‡æœåŠ¡
â”‚   â”œâ”€â”€ subscription/             # è®¢é˜…ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ service.py           # è®¢é˜…æœåŠ¡
â”‚   â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ __init__.py
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ settings.py              # é…ç½®ç®¡ç†
â”œâ”€â”€ tests/                        # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ data/                         # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ uploads/                 # ä¸Šä¼ æ–‡ä»¶
â”œâ”€â”€ alembic/                      # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ versions/
â”œâ”€â”€ logs/                         # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ main.py                       # å…¥å£æ–‡ä»¶
â”œâ”€â”€ requirements.txt              # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Dockerfile                    # Docker é…ç½®
â”œâ”€â”€ docker-compose.yml            # Docker Compose é…ç½®
â””â”€â”€ README.md                     # é¡¹ç›®æ–‡æ¡£
```

---

## ğŸ¯ äºŒæ¬¡å¼€å‘æŒ‡å—

### Agentå¼€å‘æŒ‡å—

#### 1. åˆ›å»ºè‡ªå®šä¹‰Agent

åœ¨ `agents/` ç›®å½•åˆ›å»ºæ–°çš„Agentæ–‡ä»¶ï¼Œä¾‹å¦‚ `agents/my_agent.py`ï¼š

```python
"""
è‡ªå®šä¹‰Agentç¤ºä¾‹ - æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šåˆ¶
"""
from typing import Dict, Any
from src.agents import BaseAgent, Message, ChatContext, AgentResponse, SQLiteMemoryStore


class MyCustomAgent(BaseAgent):
    """
    è‡ªå®šä¹‰Agentç±»
    
    å®ç°ç‰¹å®šé¢†åŸŸçš„åŠŸèƒ½ï¼Œå¦‚ï¼š
    - å®¢æœæ”¯æŒ
    - ä¸“ä¸šå’¨è¯¢
    - å·¥å…·é›†æˆ
    """
    
    def __init__(self, memory_store=None):
        """åˆå§‹åŒ–Agent"""
        self._name = "MyCustomAgent"
        self._description = "æä¾›XXXæœåŠ¡çš„ä¸“ä¸šAgent"
        self._memory = memory_store or SQLiteMemoryStore()
        
        # å®šä¹‰è§¦å‘å…³é”®è¯
        self._keywords = ["å…³é”®è¯1", "å…³é”®è¯2", "å…³é”®è¯3"]
    
    @property
    def name(self) -> str:
        """Agentåç§°"""
        return self._name
    
    @property  
    def description(self) -> str:
        """Agentæè¿°"""
        return self._description
    
    def can_handle(self, message: Message, context: ChatContext) -> float:
        """
        åˆ¤æ–­èƒ½å¦å¤„ç†æ¶ˆæ¯
        
        è¿”å›ç½®ä¿¡åº¦åˆ†æ•°ï¼š
        - 0.0: ä¸èƒ½å¤„ç†
        - 0.5-0.7: ä¸­ç­‰ç½®ä¿¡åº¦
        - 0.8-1.0: é«˜ç½®ä¿¡åº¦
        """
        # æ£€æŸ¥@æåŠ
        if message.has_mention(self.name):
            return 1.0
        
        content = message.content.lower()
        
        # å…³é”®è¯åŒ¹é…
        matches = sum(1 for kw in self._keywords if kw in content)
        
        if matches >= 2:
            return 0.9
        elif matches == 1:
            return 0.6
        
        return 0.0
    
    def respond(self, message: Message, context: ChatContext) -> AgentResponse:
        """ç”Ÿæˆå“åº”"""
        # è¯»å–ç”¨æˆ·å†å²
        user_memory = self.memory_read(message.user_id)
        interaction_count = user_memory.get("count", 0)
        
        # ç”Ÿæˆå“åº”
        response_text = f"æ”¶åˆ°æ¶ˆæ¯ï¼š{message.content}"
        
        # æ›´æ–°è®°å¿†
        user_memory["count"] = interaction_count + 1
        user_memory["last_message"] = message.content
        self.memory_write(message.user_id, user_memory)
        
        return AgentResponse(
            content=response_text,
            agent_name=self.name,
            confidence=0.85,
            should_continue=False
        )
    
    def memory_read(self, user_id: str) -> Dict[str, Any]:
        """è¯»å–ç”¨æˆ·è®°å¿†"""
        return self._memory.read(self.name, user_id)
    
    def memory_write(self, user_id: str, data: Dict[str, Any]) -> None:
        """ä¿å­˜ç”¨æˆ·è®°å¿†"""
        self._memory.write(self.name, user_id, data)
```

#### 2. å·¥å…·é›†æˆAgentç¤ºä¾‹

åˆ›å»ºèƒ½è°ƒç”¨å¤–éƒ¨APIçš„å·¥å…·Agentï¼š

```python
"""
å·¥å…·è°ƒç”¨Agent - é›†æˆå¤–éƒ¨æœåŠ¡
"""
import requests
from src.agents import BaseAgent, Message, ChatContext, AgentResponse


class ToolAgent(BaseAgent):
    """å·¥å…·è°ƒç”¨Agent - æä¾›å®ç”¨åŠŸèƒ½"""
    
    def __init__(self):
        self._name = "ToolAgent"
        self._description = "è°ƒç”¨å·¥å…·å®Œæˆå®é™…ä»»åŠ¡"
    
    @property
    def name(self) -> str:
        return self._name
    
    @property
    def description(self) -> str:
        return self._description
    
    def can_handle(self, message: Message, context: ChatContext) -> float:
        """åˆ¤æ–­æ˜¯å¦éœ€è¦å·¥å…·"""
        content = message.content.lower()
        
        # å·¥å…·ç›¸å…³å…³é”®è¯
        tools = ["å¤©æ°”", "æœç´¢", "è®¡ç®—", "ç¿»è¯‘"]
        if any(tool in content for tool in tools):
            return 0.9
        
        return 0.0
    
    def respond(self, message: Message, context: ChatContext) -> AgentResponse:
        """è°ƒç”¨å·¥å…·å¹¶è¿”å›ç»“æœ"""
        content = message.content.lower()
        
        if "å¤©æ°”" in content:
            result = self._get_weather()
        elif "æœç´¢" in content:
            result = self._web_search(message.content)
        elif "è®¡ç®—" in content:
            result = self._calculate(message.content)
        else:
            result = "æˆ‘å¯ä»¥å¸®ä½ ï¼šæŸ¥å¤©æ°”ã€æœç´¢ã€è®¡ç®—ç­‰"
        
        return AgentResponse(
            content=result,
            agent_name=self.name,
            confidence=0.85
        )
    
    def _get_weather(self):
        """æŸ¥è¯¢å¤©æ°” - å¯¹æ¥å¤©æ°”API"""
        # TODO: è°ƒç”¨çœŸå®å¤©æ°”API
        return "ä»Šå¤©å¤©æ°”ï¼šæ™´ï¼Œæ¸©åº¦22Â°C"
    
    def _web_search(self, query):
        """ç½‘ç»œæœç´¢ - å¯¹æ¥æœç´¢API"""
        # TODO: è°ƒç”¨æœç´¢API
        return f"æœç´¢ç»“æœï¼š{query}"
    
    def _calculate(self, expression):
        """è®¡ç®— - ä½¿ç”¨evalæˆ–ä¸“ä¸šè®¡ç®—åº“"""
        # TODO: å®ç°å®‰å…¨çš„è®¡ç®—åŠŸèƒ½
        return "è®¡ç®—ç»“æœï¼š42"
    
    def memory_read(self, user_id: str) -> Dict[str, Any]:
        return {}
    
    def memory_write(self, user_id: str, data: Dict[str, Any]) -> None:
        pass
```

#### 3. é…ç½®Router

åœ¨ä»£ç ä¸­é…ç½®Routerè¡Œä¸ºï¼ˆ`src/bot/main.py`ï¼‰ï¼š

```python
from src.agents import Router, RouterConfig, AgentLoader

# åŠ è½½æ‰€æœ‰Agent
loader = AgentLoader(agents_dir="agents")
agents = loader.load_agents()

# é…ç½®Router
config = RouterConfig(
    min_confidence=0.5,      # æœ€ä½ç½®ä¿¡åº¦é˜ˆå€¼
    max_agents=1,            # åŒæ—¶å“åº”çš„Agentæ•°é‡
    exclusive_mention=True,  # @æåŠæ—¶ç‹¬å å“åº”
    enable_parallel=False,   # æ˜¯å¦å¹¶è¡Œæ‰§è¡Œ
)

router = Router(agents, config)
```

### æ•°æ®åº“æ‰©å±•

æ·»åŠ è‡ªå®šä¹‰æ•°æ®è¡¨ï¼š

```python
from sqlalchemy import Column, Integer, String, DateTime, Text
from src.database import Base
from datetime import datetime


class CustomData(Base):
    """è‡ªå®šä¹‰æ•°æ®æ¨¡å‹"""
    __tablename__ = "custom_data"
    
    id = Column(Integer, primary_key=True)
    user_id = Column(String, index=True, nullable=False)
    content = Column(Text)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
```

### ç¯å¢ƒé…ç½®æ‰©å±•

åœ¨ `.env` æ·»åŠ è‡ªå®šä¹‰é…ç½®ï¼š

```env
# è‡ªå®šä¹‰Agenté…ç½®
CUSTOM_AGENT_ENABLED=true
CUSTOM_API_KEY=your_api_key
CUSTOM_API_URL=https://api.example.com
```

åœ¨ä»£ç ä¸­è¯»å–é…ç½®ï¼š

```python
import os
from config import settings

# è¯»å–ç¯å¢ƒå˜é‡
api_key = os.getenv("CUSTOM_API_KEY")
api_url = os.getenv("CUSTOM_API_URL")
enabled = os.getenv("CUSTOM_AGENT_ENABLED", "false").lower() == "true"
```

### æ·»åŠ æ–°å‘½ä»¤

åœ¨ `src/handlers/commands.py` æ·»åŠ æ–°å‘½ä»¤ï¼š

```python
async def custom_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """è‡ªå®šä¹‰å‘½ä»¤å¤„ç†å™¨"""
    await update.message.reply_text("è¿™æ˜¯è‡ªå®šä¹‰å‘½ä»¤çš„å“åº”")

# åœ¨ main.py ä¸­æ³¨å†Œ
app.add_handler(CommandHandler("custom", custom_command))
```

---

## ğŸ¯ å¼€å‘è®¡åˆ’

### v0.1.0 - åŸºç¡€ç‰ˆæœ¬ (å½“å‰) âœ…

- [x] é¡¹ç›®ç»“æ„æ­å»º
- [x] Telegram Bot åŸºç¡€åŠŸèƒ½
- [x] AI å¯¹è¯é›†æˆ
- [x] è®¢é˜…ç³»ç»ŸåŸºç¡€
- [x] æ•°æ®åº“æ¨¡å‹
- [x] Docker éƒ¨ç½²é…ç½®

### v0.2.0 - æ”¯ä»˜ä¸ AI æ‰©å±• (å½“å‰) âœ…

- [x] å¾®ä¿¡æ”¯ä»˜é›†æˆ
- [x] vLLM æä¾›å•†æ”¯æŒ
- [x] æ”¯ä»˜å‘½ä»¤å’Œå¤„ç†
- [x] æµ‹è¯•è¦†ç›–

### v0.3.0 - å›¾ç‰‡åŠŸèƒ½

- [ ] å›¾ç‰‡ç”Ÿæˆ (DALL-E)
- [ ] æƒ…æ„Ÿå›¾ç‰‡åº“
- [ ] å›¾ç‰‡ç¼“å­˜ç³»ç»Ÿ

### v0.4.0 - æ”¯ä»˜å¢å¼º

- [ ] Stripe æ”¯ä»˜é›†æˆ
- [ ] è®¢é˜…è‡ªåŠ¨ç»­è´¹
- [ ] å‘ç¥¨ç”Ÿæˆ
- [ ] å¾®ä¿¡æ”¯ä»˜å›è°ƒå¤„ç†

### v0.5.0 - é«˜çº§åŠŸèƒ½

- [ ] æƒ…æ„Ÿåˆ†æ
- [ ] ä¸ªæ€§åŒ–å¯¹è¯
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] è¯­éŸ³æ¶ˆæ¯æ”¯æŒ

### v1.0.0 - ç”Ÿäº§å°±ç»ª

- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç›‘æ§å‘Šè­¦
- [ ] å®Œæ•´æµ‹è¯•è¦†ç›–
- [ ] API æ–‡æ¡£
- [ ] ç”¨æˆ·æ–‡æ¡£

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€å¯¹è¯

```
ç”¨æˆ·: ä½ å¥½
Bot: ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„æƒ…æ„Ÿé™ªä¼´åŠ©æ‰‹ã€‚ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ

ç”¨æˆ·: ä»Šå¤©æœ‰ç‚¹ç´¯
Bot: å¬èµ·æ¥ä½ ä»Šå¤©å¾ˆè¾›è‹¦å‘¢ã€‚å·¥ä½œæˆ–è€…ç”Ÿæ´»ä¸Šé‡åˆ°ä»€ä¹ˆå‹åŠ›äº†å—ï¼Ÿ
    æˆ‘åœ¨è¿™é‡Œï¼Œå¯ä»¥å’Œæˆ‘èŠèŠã€‚
```

### å‘½ä»¤ä½¿ç”¨

```
/start  - å¼€å§‹ä½¿ç”¨æœºå™¨äºº
/help   - æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
/status - æŸ¥çœ‹è®¢é˜…çŠ¶æ€å’Œä½¿ç”¨æƒ…å†µ
/subscribe - æŸ¥çœ‹è®¢é˜…è®¡åˆ’
/pay_basic - è®¢é˜…åŸºç¡€ç‰ˆï¼ˆÂ¥9.99/æœˆï¼‰
/pay_premium - è®¢é˜…é«˜çº§ç‰ˆï¼ˆÂ¥19.99/æœˆï¼‰
/check_payment - æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
/image  - è·å–æ¸©é¦¨å›¾ç‰‡
```

### è®¢é˜…æµç¨‹

**ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜è®¢é˜…ï¼š**

1. å‘é€ `/pay_basic` æˆ– `/pay_premium` å‘½ä»¤
2. æ”¶åˆ°æ”¯ä»˜äºŒç»´ç é“¾æ¥
3. ä½¿ç”¨å¾®ä¿¡æ‰«ç æ”¯ä»˜
4. å‘é€ `/check_payment` ç¡®è®¤æ”¯ä»˜
5. ç«‹å³äº«å—é«˜çº§åŠŸèƒ½

---

## ğŸ”§ é«˜çº§é…ç½®

### vLLM é›†æˆ

å¦‚æœæ‚¨æœ‰è‡ªå·±çš„ LLM æ¨ç†æœåŠ¡å™¨ï¼ˆåŸºäº vLLMï¼‰ï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š

1. **å¯åŠ¨ vLLM æœåŠ¡å™¨**

```bash
python -m vllm.entrypoints.openai.api_server \
    --model your-model-name \
    --host 0.0.0.0 \
    --port 8000
```

2. **é…ç½®ç¯å¢ƒå˜é‡**

```env
VLLM_API_URL=http://your-vllm-server:8000
VLLM_API_TOKEN=your_optional_token  # å¯é€‰
VLLM_MODEL=your-model-name
```

3. **ä¼˜å…ˆçº§**

ç³»ç»Ÿä¼šæŒ‰ä»¥ä¸‹é¡ºåºé€‰æ‹© AI æä¾›å•†ï¼š
- vLLMï¼ˆå¦‚æœé…ç½®äº† VLLM_API_URLï¼‰
- OpenAIï¼ˆå¦‚æœé…ç½®äº† OPENAI_API_KEYï¼‰
- Anthropicï¼ˆå¦‚æœé…ç½®äº† ANTHROPIC_API_KEYï¼‰

### å¾®ä¿¡æ”¯ä»˜é…ç½®

1. **ç”³è¯·å¾®ä¿¡æ”¯ä»˜å•†æˆ·å·**
   - è®¿é—® [å¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å°](https://pay.weixin.qq.com/)
   - æ³¨å†Œå¹¶ç”³è¯·å•†æˆ·å·

2. **è·å–é…ç½®ä¿¡æ¯**
   - APP ID
   - å•†æˆ·å· (MCH ID)
   - API å¯†é’¥ (API Key)
   - API v3 å¯†é’¥
   - è¯ä¹¦åºåˆ—å·
   - API ç§é’¥æ–‡ä»¶è·¯å¾„

3. **é…ç½®å›è°ƒ URL**
   
   åœ¨å¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å°è®¾ç½®æ”¯ä»˜å›è°ƒ URLï¼š
   ```
   https://your-domain.com/wechat/notify
   ```

4. **è®¾ç½®ç¯å¢ƒå˜é‡**ï¼ˆå‚è§ä¸Šé¢çš„æ”¯ä»˜é…ç½®éƒ¨åˆ†ï¼‰

---

## ğŸ”’ å®‰å…¨æ€§

- ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
- API å¯†é’¥åŠ å¯†å­˜å‚¨
- ç”¨æˆ·æ•°æ®éšç§ä¿æŠ¤
- è¯·æ±‚é€Ÿç‡é™åˆ¶
- SQL æ³¨å…¥é˜²æŠ¤

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä¸ºä¸“æœ‰è½¯ä»¶ï¼Œç‰ˆæƒæ‰€æœ‰ Â© 2026 SoulmateBot å›¢é˜Ÿã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

æœªç»æˆæƒï¼Œç¦æ­¢å¤åˆ¶ã€ä¿®æ”¹æˆ–åˆ†å‘æœ¬è½¯ä»¶ã€‚

---

<div align="center">

**SoulmateBot - ä¸“ä¸šæ™ºèƒ½é™ªä¼´æœºå™¨äººç³»ç»Ÿ**

ç‰ˆæƒæ‰€æœ‰ Â© 2026

</div>
